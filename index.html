<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora SOFA-2 (2025) – Dr. Russi</title>
  <meta name="description" content="Calculadora SOFA-2 (2025) con interfaz médica y fondo verde." />
  <style>
    :root{
      /* Tema verde (manteniendo tu estilo) */
      --bg:#052e1b;               /* verde oscuro de fondo */
      --bg2:#0a3a22;              /* tono secundario */
      --card:#0e2d1f;             /* tarjeta */
      --muted:#a7f3d0;            /* verde menta suave para textos secundarios */
      --text:#ecfdf5;             /* casi blanco verdoso */
      --accent:#34d399;           /* verde acento */
      --accent2:#6ee7b7;          /* verde claro */
      --ok:#10b981;               /* verde ok */
      --warn:#f59e0b;             /* ámbar */
      --bad:#ef4444;              /* rojo */
      --border:#134e4a;           /* verde petróleo para bordes */
      --chip:#062418;             /* chip */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 10% -10%, #0f5131 10%, transparent 50%),
        radial-gradient(1400px 900px at 120% 20%, #064e3b 10%, transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }
    a{color:var(--accent)}
    header{max-width:1100px;margin:32px auto 12px;padding:0 16px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 30px #34d39944}
    h1{margin:0;font-size:clamp(22px,2.8vw,36px);letter-spacing:.3px}
    .subtitle{margin-top:6px;color:var(--muted)}
    main{max-width:1100px;margin:16px auto 80px;padding:0 16px;display:grid;grid-template-columns:1.2fr .8fr;gap:18px}
    @media (max-width:980px){main{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg, #0b2419, #0b2419cc 60%, #0b241980);border:1px solid var(--border);border-radius:18px;box-shadow:0 8px 30px #00000055}
    .card h2{margin:0;padding:18px 18px 0;font-size:clamp(18px,2.2vw,22px)}
    .card .content{padding:16px 18px 18px}
    .grid{display:grid;gap:12px}
    .grid.two{grid-template-columns:repeat(2,1fr)}
    @media (max-width:780px){.grid.two{grid-template-columns:1fr}}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:4px}
    input, select{width:100%;background:#052317;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px 12px;font-size:14px;outline:none}
    input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button{appearance:none;margin:0}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:780px){.row{grid-template-columns:1fr}}
    .hint{font-size:12px;color:var(--muted)}
    .switch{display:flex;align-items:center;gap:10px}
    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .actions{display:flex;gap:10px;margin-top:14px}
    button{cursor:pointer;border:1px solid var(--border);background:linear-gradient(180deg,#0b2419,#052015);color:#fff;padding:12px 14px;border-radius:12px;font-weight:600}
    button.primary{background:linear-gradient(180deg,#10b981,#059669);border-color:#047857}
    button.ghost{background:transparent}
    .result{display:grid;gap:10px}
    .score{font-size:48px;font-weight:800;letter-spacing:.5px}
    .score.ok{color:var(--ok)}
    .score.warn{color:var(--warn)}
    .score.bad{color:var(--bad)}
    .kpi{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#062418;border:1px solid var(--border);border-radius:14px}
    .kpi small{color:var(--muted)}
    .muted{color:var(--muted)}
    footer{max-width:1100px;margin:28px auto 40px;padding:0 16px;color:var(--muted);display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px}
    .ref{font-size:12px;line-height:1.45}
    .divider{height:1px;background:var(--border);margin:16px 0}
    .badge{font-size:11px;padding:3px 8px;border:1px solid var(--border);border-radius:999px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Calculadora SOFA-2 (2025)</h1>
        <div class="subtitle">Herramienta realizada por el <strong>Dr. Russi</strong>.</div>
      </div>
    </div>
  </header>

  <main>
    <!-- ENTRADAS -->
    <section class="card" id="inputs-card">
      <h2>DATOS CLÍNICOS</h2>
      <div class="content grid">
        <div class="chip">Complete lo disponible. La escala asigna 0–4 puntos por sistema (0–24 total).</div>

        <!-- CEREBRO -->
        <div class="divider"></div>
        <div class="grid two">
          <div>
            <h3>CEREBRO (GCS / Delirium)</h3>
            <label for="gcs">Glasgow (3–15)</label>
            <input type="number" id="gcs" min="3" max="15" step="1" value="15" />
            <div class="switch" style="margin-top:8px">
              <input type="checkbox" id="delirium" />
              <label for="delirium">Tratamiento farmacológico de delirium</label>
            </div>
            <p class="hint">Si el paciente está muy sedado, use el último GCS pre-sedación.</p>
          </div>

          <!-- RESPIRATORIO -->
          <div>
            <h3>RESPIRATORIO</h3>
            <label for="pafi">PaO₂/FiO₂ (mmHg)</label>
            <input type="number" id="pafi" min="0" step="1" placeholder="Ej: 220" />
            <div class="row" style="margin-top:8px">
              <div>
                <label for="sofi">SpO₂/FiO₂ (si PaO₂/FiO₂ no disponible)</label>
                <input type="number" id="sofi" min="0" step="1" placeholder="Ej: 200" />
              </div>
              <div>
                <label for="vent">Soporte ventilatorio</label>
                <select id="vent">
                  <option value="none">Sin soporte</option>
                  <option value="hfno">HFNO/CPAP/NIV</option>
                  <option value="imv">Ventilación mecánica invasiva</option>
                  <option value="home">Ventilación domiciliaria</option>
                </select>
              </div>
            </div>
            <div class="switch" style="margin-top:8px">
              <input type="checkbox" id="ecmo" />
              <label for="ecmo">ECMO</label>
            </div>
            <p class="hint">Para puntuar 3–4 se requiere soporte ventilatorio (HFNO/CPAP/NIV o VMI) o ECMO según cortes.</p>
          </div>
        </div>

        <!-- HEMOSTASIS / RENAL -->
        <div class="grid two">
          <div>
            <h3>HEMOSTASIS</h3>
            <label for="plt">Plaquetas (×10³/µL)</label>
            <input type="number" id="plt" min="0" step="1" placeholder="Ej: 180" />
          </div>
          <div>
            <h3>RENAL</h3>
            <div class="row">
              <div>
                <label for="cr">Creatinina (mg/dL)</label>
                <input type="number" id="cr" min="0" step="0.01" placeholder="Ej: 1.1" />
              </div>
              <div>
                <label for="uop">Diuresis (mL/kg/h)</label>
                <input type="number" id="uop" min="0" step="0.01" placeholder="Ej: 0.3" />
              </div>
            </div>
            <div class="row" style="margin-top:8px">
              <div>
                <label for="uopDur">Duración de baja diuresis</label>
                <select id="uopDur">
                  <option value="none">No aplica</option>
                  <option value="6-12">6–12 h &lt;0.5</option>
                  <option value="12+">≥12 h &lt;0.3</option>
                  <option value="24+">≥24 h &lt;0.3</option>
                  <option value="anuria12">Anuria ≥12 h</option>
                </select>
              </div>
              <div>
                <label for="rrt">Terapia de reemplazo renal (TRR)</label>
                <select id="rrt">
                  <option value="no">No</option>
                  <option value="si">Recibiendo TRR / cumple criterios</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- CARDIO / HEPÁTICO -->
        <div class="grid two">
          <div>
            <h3>CARDIOVASCULAR</h3>
            <div class="row">
              <div>
                <label for="map">PAM (mmHg)</label>
                <input type="number" id="map" min="0" step="1" placeholder="Ej: 72" />
              </div>
              <div>
                <label for="mech">Soporte mecánico</label>
                <select id="mech">
                  <option value="no">No</option>
                  <option value="si">IABP/Impella/ECMO VA u otro</option>
                </select>
              </div>
            </div>
            <div class="row" style="margin-top:8px">
              <div>
                <label for="ne">Norepinefrina (µg/kg/min)</label>
                <input type="number" id="ne" min="0" step="0.01" />
              </div>
              <div>
                <label for="epi">Epinefrina (µg/kg/min)</label>
                <input type="number" id="epi" min="0" step="0.01" />
              </div>
            </div>
            <label style="margin-top:8px">Otros vasopresores/inotrópicos (≥1)</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" id="dop"/> Dopamina</label>
              <label class="chip"><input type="checkbox" id="dob"/> Dobutamina</label>
              <label class="chip"><input type="checkbox" id="vaso"/> Vasopresina</label>
              <label class="chip"><input type="checkbox" id="levo"/> Levosimendán</label>
              <label class="chip"><input type="checkbox" id="mili"/> Milrinona</label>
              <label class="chip"><input type="checkbox" id="phen"/> Fenilefrina</label>
              <label class="chip"><input type="checkbox" id="ang2"/> Angiotensina II</label>
              <label class="chip"><input type="checkbox" id="metar"/> Metaraminol</label>
            </div>
          </div>
          <div>
            <h3>HÍGADO</h3>
            <label for="bili">Bilirrubina total (mg/dL)</label>
            <input type="number" id="bili" min="0" step="0.1" placeholder="Ej: 1.0" />
          </div>
        </div>

        <div class="actions">
          <button class="primary" id="calc">Calcular SOFA-2</button>
          <button class="ghost" id="reset">Limpiar</button>
        </div>
      </div>
    </section>

    <!-- RESULTADOS -->
    <section class="card" id="results-card">
      <h2>RESULTADOS</h2>
      <div class="content result">
        <div class="kpi">
          <div>
            <div class="muted">SOFA-2 TOTAL</div>
            <div id="score" class="score">—</div>
          </div>
          <div>
            <span id="riskBadge" class="badge">Riesgo no estimado</span>
          </div>
        </div>
        <div class="grid">
          <div class="kpi"><div><strong>Cerebro</strong><br><small id="brainTxt" class="muted">—</small></div><div><strong id="brainPts">0</strong> pts</div></div>
          <div class="kpi"><div><strong>Respiratorio</strong><br><small id="respTxt" class="muted">—</small></div><div><strong id="respPts">0</strong> pts</div></div>
          <div class="kpi"><div><strong>Hemostasis</strong><br><small id="hemoTxt" class="muted">—</small></div><div><strong id="hemoPts">0</strong> pts</div></div>
          <div class="kpi"><div><strong>Renal</strong><br><small id="renalTxt" class="muted">—</small></div><div><strong id="renalPts">0</strong> pts</div></div>
          <div class="kpi"><div><strong>Cardiovascular</strong><br><small id="cardioTxt" class="muted">—</small></div><div><strong id="cardioPts">0</strong> pts</div></div>
          <div class="kpi"><div><strong>Hígado</strong><br><small id="liverTxt" class="muted">—</small></div><div><strong id="liverPts">0</strong> pts</div></div>
        </div>
        <p class="hint">Interpretación general: a mayor puntaje, mayor disfunción orgánica. Priorice la tendencia seriada.</p>
      </div>
    </section>
  </main>

  <footer>
    <div>© 2025 <strong>Dr. Russi</strong>. Todos los derechos reservados.</div>
    <div>Herramienta educativa. No sustituye juicio clínico.</div>
  </footer>

  <!-- REFERENCIA (formato como en tu página de insulinas) -->
  <section style="max-width:1100px;margin:0 auto 80px;padding:0 16px">
    <div class="card">
      <h2>REFERENCIA</h2>
      <div class="content ref">
        <p>
          Moreno R, Rhodes A, Ranzani OT, et al. <em>Development and Validation of the Sequential Organ Failure Assessment (SOFA)-2 Score.</em>
          JAMA. 2025. Incluye tablas de criterios por órgano, uso de SpO₂/FiO₂ como sustituto y umbrales de vasopresores.
        </p>
      </div>
    </div>
  </section>

<script>
/* Utilidades */
function num(v){const n=parseFloat(v);return Number.isFinite(n)?n:NaN}
function any(ids){return ids.some(id=>document.getElementById(id).checked)}

/* CEREBRO */
function calcBrain(){
  const gcs = num(document.getElementById('gcs').value);
  const delirium = document.getElementById('delirium').checked;
  if (!Number.isFinite(gcs)) return {pts:0, txt:"GCS no informado"};
  if (gcs>=15) return {pts:0, txt:"GCS 15"};
  if ((gcs>=13 && gcs<=14) || delirium) return {pts:1, txt: delirium?"Delirium tratado":"GCS 13–14"};
  if (gcs>=9 && gcs<=12) return {pts:2, txt:"GCS 9–12"};
  if (gcs>=6 && gcs<=8) return {pts:3, txt:"GCS 6–8"};
  return {pts:4, txt:"GCS 3–5"};
}

/* RESPIRATORIO (PaO2/FiO2 o SpO2/FiO2; requiere soporte para 3–4) */
function calcResp(){
  const pafi = num(document.getElementById('pafi').value);
  const sofi = num(document.getElementById('sofi').value);
  const vent = document.getElementById('vent').value !== 'none';
  const ecmo = document.getElementById('ecmo').checked;
  let base = NaN, by = "PaO₂/FiO₂";
  if (!Number.isNaN(pafi)) { base = pafi; by = "PaO₂/FiO₂"; }
  else if (!Number.isNaN(sofi)) { base = sofi; by = "SpO₂/FiO₂"; }
  else return {pts:0, txt:"Sin datos respiratorios"};

  let pts=0;
  if (by==="PaO₂/FiO₂"){
    if (base>300) pts=0;
    else if (base>225) pts=1;
    else if (base>150) pts=2;
    else if (base>75)  pts = vent?3:2;
    else               pts = (vent||ecmo)?4:2;
  } else { // SpO₂/FiO₂ equivalentes
    if (base>300) pts=0;
    else if (base>250) pts=1;
    else if (base>200) pts=2;
    else if (base>120) pts = vent?3:2;
    else               pts = (vent||ecmo)?4:2;
  }
  if (ecmo) pts = Math.max(pts,4);
  const extra = (vent?" + soporte ventilatorio":"") + (ecmo?" + ECMO":"");
  return {pts, txt:`${by} ${base}${extra}`};
}

/* HEMOSTASIS (plaquetas) */
function calcHemo(){
  const plt = num(document.getElementById('plt').value);
  if (!Number.isFinite(plt)) return {pts:0, txt:"Plaquetas no informadas"};
  let pts=0;
  if (plt>150) pts=0; else if (plt>100) pts=1; else if (plt>80) pts=2; else if (plt>50) pts=3; else pts=4;
  return {pts, txt:`Plaquetas ${plt}`};
}

/* RENAL (creatinina, diuresis con duración, TRR) */
function calcRenal(){
  const cr = num(document.getElementById('cr').value);
  const uop = num(document.getElementById('uop').value);
  const dur = document.getElementById('uopDur').value;
  const rrt = document.getElementById('rrt').value === 'si';
  if (rrt) return {pts:4, txt:"TRR en curso / indicación"};
  let pts=0, reasons=[];
  if (Number.isFinite(cr)){
    if (cr<=1.2) pts=Math.max(pts,0), reasons.push(`Cr ${cr}`);
    else if (cr<=2.0) pts=Math.max(pts,1), reasons.push("Cr ≤2.0");
    else if (cr<=3.5) pts=Math.max(pts,2), reasons.push("Cr ≤3.5");
    else pts=Math.max(pts,3), reasons.push("Cr >3.5");
  }
  if (Number.isFinite(uop)){
    if (dur==='6-12' && uop<0.5) pts=Math.max(pts,1), reasons.push("UO <0.5 × 6–12 h");
    if (dur==='12+' && uop<0.3)  pts=Math.max(pts,2), reasons.push("UO <0.3 × ≥12 h");
    if (dur==='24+' && uop<0.3)  pts=Math.max(pts,3), reasons.push("UO <0.3 × ≥24 h");
    if (dur==='anuria12')         pts=Math.max(pts,3), reasons.push("Anuria ≥12 h");
  }
  if (!reasons.length) reasons.push("Sin criterios renales");
  return {pts, txt:reasons.join(" + ")};
}

/* CARDIO (PAM, NA + A, otros vasopresores, soporte mecánico) */
function calcCardio(){
  const map = num(document.getElementById('map').value);
  const ne  = num(document.getElementById('ne').value)  || 0;
  const epi = num(document.getElementById('epi').value) || 0;
  const sum = ne + epi;
  const mech = document.getElementById('mech').value === 'si';
  const others = ['dop','dob','vaso','levo','mili','phen','ang2','metar'].some(id=>document.getElementById(id).checked);

  let pts=0, reasons=[];
  const usingAny = (ne>0 || epi>0 || others || mech);

  if (!usingAny){
    if (Number.isFinite(map) && map<70){ pts=1; reasons.push("PAM <70 sin vasopresor"); }
    else { pts=0; reasons.push("PAM ≥70 sin vasopresor"); }
  } else {
    if (mech){ pts=4; reasons.push("Soporte mecánico"); }
    if (sum>0.4){ pts=Math.max(pts,4); reasons.push("NA+A >0.4"); }
    else if (sum>0.2){ pts=Math.max(pts,3); reasons.push("NA+A ≤0.4"); if (others) reasons.push("+ otro"); }
    else if (sum>0){ if (others){ pts=Math.max(pts,3); reasons.push("NA+A ≤0.2 + otro"); } else { pts=Math.max(pts,2); reasons.push("NA+A ≤0.2"); } }
    else { if (others){ pts=Math.max(pts,2); reasons.push("Otro vasopresor/inótropo"); } }
  }
  return {pts, txt:reasons.join(" | ")};
}

/* HÍGADO (bilirrubina) */
function calcLiver(){
  const bili = num(document.getElementById('bili').value);
  if (!Number.isFinite(bili)) return {pts:0, txt:"Bilirrubina no informada"};
  let pts=0;
  if (bili<=1.2) pts=0; else if (bili<=3.0) pts=1; else if (bili<=6.0) pts=2; else if (bili<=12.0) pts=3; else pts=4;
  return {pts, txt:`BT ${bili} mg/dL`};
}

/* PRESENTACIÓN */
function setBadge(score){
  const el=document.getElementById('riskBadge');
  el.textContent = score===0 ? "Riesgo mínimo (use clínica)"
                  : score<=6 ? "Riesgo bajo-intermedio"
                  : score<=12? "Riesgo intermedio-alto"
                  : "Riesgo alto";
}
function compute(){
  const brain=calcBrain(), resp=calcResp(), hemo=calcHemo(), renal=calcRenal(), cardio=calcCardio(), liver=calcLiver();
  const total=brain.pts+resp.pts+hemo.pts+renal.pts+cardio.pts+liver.pts;

  const scoreEl=document.getElementById('score');
  scoreEl.textContent=total;
  scoreEl.className='score ' + (total<=6?'ok': total<=12?'warn':'bad');
  setBadge(total);

  document.getElementById('brainPts').textContent=brain.pts; document.getElementById('brainTxt').textContent=brain.txt;
  document.getElementById('respPts').textContent =resp.pts;  document.getElementById('respTxt').textContent =resp.txt;
  document.getElementById('hemoPts').textContent =hemo.pts;  document.getElementById('hemoTxt').textContent =hemo.txt;
  document.getElementById('renalPts').textContent=renal.pts; document.getElementById('renalTxt').textContent=renal.txt;
  document.getElementById('cardioPts').textContent=cardio.pts;document.getElementById('cardioTxt').textContent=cardio.txt;
  document.getElementById('liverPts').textContent =liver.pts; document.getElementById('liverTxt').textContent =liver.txt;
}
function resetAll(){
  document.querySelectorAll('input').forEach(el=>{if(el.type==='checkbox'){el.checked=false}else{el.value=''}});
  document.querySelectorAll('select').forEach(el=>el.selectedIndex=0);
  document.getElementById('gcs').value=15;
  document.getElementById('score').textContent='—';
  document.getElementById('score').className='score';
  ['brain','resp','hemo','renal','cardio','liver'].forEach(k=>{
    document.getElementById(k+'Pts').textContent='0';
    document.getElementById(k+'Txt').textContent='—';
  });
  document.getElementById('riskBadge').textContent='Riesgo no estimado';
}
document.getElementById('calc').addEventListener('click', compute);
document.getElementById('reset').addEventListener('click', resetAll);
</script>
</body>
</html>
